<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:aop="http://www.springframework.org/schema/aop"
       xmlns:tx="http://www.springframework.org/schema/tx" xmlns:jdbc="http://www.springframework.org/schema/jdbc"
       xmlns:context="http://www.springframework.org/schema/context"
       xmlns:jpa="http://www.springframework.org/schema/data/jpa"
       xmlns:task="http://www.springframework.org/schema/task"
       xsi:schemaLocation="
     http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-3.0.xsd
     http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.0.xsd
     http://www.springframework.org/schema/jdbc http://www.springframework.org/schema/jdbc/spring-jdbc-3.0.xsd
     http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx-3.0.xsd
     http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop-3.0.xsd
     http://www.springframework.org/schema/data/jpa http://www.springframework.org/schema/data/jpa/spring-jpa-1.3.xsd
     http://www.springframework.org/schema/task http://www.springframework.org/schema/task/spring-task-3.0.xsd
     http://www.springframework.org/schema/data/repository http://www.springframework.org/schema/data/repository/spring-repository-1.6.xsd">

  <context:annotation-config />
  
  <tx:annotation-driven transaction-manager="transactionManager" />
  
  <context:component-scan base-package="com.mmd.mssp.repository"></context:component-scan>
  <context:component-scan base-package="com.mmd.mssp.service"></context:component-scan>
  <context:component-scan base-package="com.mmd.mssp.service.impl"></context:component-scan>
  <context:component-scan base-package="com.mmd.mssp.timer"></context:component-scan>
  
  <task:annotation-driven />
   <task:scheduled-tasks>
  		<task:scheduled ref="MonthInventory" method="job1" cron="0 0 23 * * ?"/>
   </task:scheduled-tasks> 
  
  
  <bean id="propertyConfigurer" class="org.springframework.beans.factory.config.PropertyPlaceholderConfigurer">
    <property name="locations">
      <list>
        <value>classpath:datasource.properties</value>
        <value>classpath:config.properties</value>
      </list>
    </property>
  </bean>
 
  <bean id="dataSource" class="org.apache.commons.dbcp.BasicDataSource"
        destroy-method="close">
    <property name="driverClassName" value="${db.driver}"></property>
    <property name="url" value="${db.url}"></property>
    <property name="username" value="${db.user}"></property>
    <property name="password" value="${db.password}"></property>
    <!-- test for remove these idle connections  -->
   <!--  <property name="removeAbandoned" value="true" />
    <property name="maxActive" value="${db.maxActive}"></property>
    <property name="maxIdle" value="${db.maxIdle}"></property>
    <property name="maxWait" value="${db.maxWait}"></property> -->
    <property name="defaultAutoCommit" value="false"></property>
    <property name="testOnBorrow" value="false"></property>
    
    <!-- 一个小时 检测连接的有效性 -->
    <property name="testWhileIdle" value="true"></property>
    <property name="validationQuery">
      <value>SELECT 1</value>
    </property>
    <property name="timeBetweenEvictionRunsMillis" value="3600000"></property>
  </bean>

  <bean id="openJpaVendorAdapter" class="org.springframework.orm.jpa.vendor.OpenJpaVendorAdapter">
    <property name="showSql" value="false"/>
    <property name="generateDdl" value="false"/>
    <property name="databasePlatform" value="org.apache.openjpa.jdbc.sql.MySQLDictionary"/> 
    <!-- <property name="databasePlatform" value="org.apache.openjpa.jdbc.sql.SQLServerDictionary"/> -->
 
 </bean>

  <bean id="entityManagerFactory"
        class="org.springframework.orm.jpa.LocalContainerEntityManagerFactoryBean">
    <property name="dataSource" ref="dataSource" />
    <property name="jpaVendorAdapter" ref="openJpaVendorAdapter" />
    <property name="persistenceUnitName" value="mssp-entity" />
    <property name="loadTimeWeaver">
      <bean class="org.springframework.instrument.classloading.InstrumentationLoadTimeWeaver" />
    </property>
  </bean>
  <bean id="transactionManager"
        class="org.springframework.orm.jpa.JpaTransactionManager">
    <property name="entityManagerFactory" ref="entityManagerFactory"></property>
  </bean>

  <bean id="mailConfig" class="com.mmd.mssp.domain.vo.MailConfig">
    <property name="serverName" value="${server.name}"/>
    <property name="senderName" value="${mail.senderName} "/>
    <property name="senderAddress" value="${mail.senderAddress}"/>
    <property name="hostName" value="${mail.hostName}"/>
    <property name="authenticator" ref="defaultAuthenticator"/>
    <property name="smtpPort" value="${mail.smtpPort}"/>
    <property name="SSLOnConnect" value="true"/>
  </bean>
  
  
   <bean id="defaultAuthenticator" class="org.apache.commons.mail.DefaultAuthenticator">
    <constructor-arg index="0" value="1075993538@qq.com"/>
    <constructor-arg index="1" value="gsrtgevskansihhb"/>
  </bean>
  
  <bean id="sellOutUpdateMailFormat" class="com.mmd.mssp.domain.vo.MailFormat">
    <constructor-arg ref="mailConfig"></constructor-arg>
    <property name="title" value="SellOut修改申请"/>
    <property name="contentPath" value="classpath:mail/sellOutUpdateApply.html"/>
  </bean>
  
  <bean id="B2BProjectApplyMailFormat" class="com.mmd.mssp.domain.vo.MailFormat">
    <constructor-arg ref="mailConfig"></constructor-arg>
    <property name="title" value="B2B项目申请"/>
    <property name="contentPath" value="classpath:mail/B2BProjectApply.html"/>
  </bean>
  
  <bean id="B2IProjectApplyMailFormat" class="com.mmd.mssp.domain.vo.MailFormat">
    <constructor-arg ref="mailConfig"></constructor-arg>
    <property name="title" value="B2I项目申请"/>
    <property name="contentPath" value="classpath:mail/b2IProjectApply.html"/>
  </bean>
  
  <bean id="messageMailFormat" class="com.mmd.mssp.domain.vo.MailFormat">
    <constructor-arg ref="mailConfig"></constructor-arg>
    <property name="title" value="通知"/>
    <property name="contentPath" value="classpath:mail/message.html"/>
  </bean>
  
  <!-- 授权申请pdf格式 -->
   <bean id="comentNotePDFFormat" class="com.mmd.mssp.domain.vo.PDFFormat">
    	<property name="title" value="授权申请"/>
    	<property name="contentPath" value="classpath:pdf/commitmentNote.html"/>
  </bean>
  
    <!-- 样机申请pdf格式 -->
   <bean id="sampleDealPDFFormat" class="com.mmd.mssp.domain.vo.PDFFormat">
    	<property name="title" value="样机申请"/>
    	<property name="contentPath" value="classpath:pdf/sampleDeal.html"/>
  </bean>
  
  <!-- 样机申请pdf格式 -->
   <bean id="entrustPicPDFFormat" class="com.mmd.mssp.domain.vo.PDFFormat">
    	<property name="title" value="一次性发货委托申请"/>
    	<property name="contentPath" value="classpath:pdf/entrustPic.html"/>
  </bean>

  <jpa:repositories
    base-package="com.mmd.mssp.repository"
    entity-manager-factory-ref="entityManagerFactory"
    transaction-manager-ref="transactionManager" />
         
         <bean id="multipartResolver"  class="org.springframework.web.multipart.commons.CommonsMultipartResolver"/>
         
         <bean id ="defaultPasswordService" class="org.apache.shiro.authc.credential.DefaultPasswordService" />
</beans>
